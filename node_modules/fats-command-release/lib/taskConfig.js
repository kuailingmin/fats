var fats = require('fats-kernel');
require("date-format-lite");

var taskConfig = module.exports = function (opts) {

	if (!fats.util.isJson(opts)) {
		fats.log.error('config file parsing failed');
		process.exit(1);
	}

	var root = process.cwd();
	var defaultTaskConfig = {
		'fats': {
			'template': {
				'today': function (format) {
					var d;
					if (/^utc:/i.test(format)) {
						d = new Date();
					} else {
						d = fats.util.localDate();
					}
					format = format.replace(/^utc:/i, '');
					return d.format('UTC:' + format);
				}
			}
		},
		'env': {
			'root': root
		},
		taskList: {}
	};
	fats.util.extend(defaultTaskConfig.taskList, opts);

	fats.taskConfig = defaultTaskConfig

};
