/*
 * fats server command
 * */
exports.name = 'release';
exports.desc = 'release project';

var fats = require('fats-kernel');
// taskConfig
fats.taskConfig = require('./lib/taskConfig.js');
// registerTask
fats.registerTask = require('./lib/registerTask.js');


var path = require('path');
var fs = require('fs');

exports.register = function (commander) {

	var fats = require('fats-kernel');

	// output version info
	var first = process.argv[3];
	if (first === '-v' || first === '--version') {
		fats.util.version(__dirname + '/package.json');
		process.exit(0);
	}

	commander
		.action(function (cli) {

			var root = process.cwd();
			var filePath = root + '/Fatsfile.js';
			var exists = fs.existsSync(filePath);

			if (!exists) {
				fats.log.error('Missing config file [Fatsfile.js]');
			} else {
				try {
					require(filePath)(fats);
				} catch (e) {
					fats.log.error('Config file run error [Fatsfile.js]', false);
					fats.log.out(String(e));
				}
			}


		});
};